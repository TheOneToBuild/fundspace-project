import{u as B,r as f,a as v,j as e,X as V,C as X,b as G,P as J,T as K,R as O,c as Q,M as W,S as Y,d as Z,s as U}from"./index-5NuBycb7.js";function te({post:o,images:r,initialIndex:g,isOpen:h,onClose:m,onReaction:S,selectedReaction:C,currentUserProfile:x,likeCount:y,reactionSummary:I,commentCount:p,showImageSection:E=!0,onCommentAdded:T,onCommentDeleted:D,reactors:L=[],onViewReactions:M}){var k,$;const u=B(),[b,j]=f.useState(g),[w,N]=f.useState(!1);f.useEffect(()=>{j(g)},[g]),f.useEffect(()=>(document.body.style.overflow=h?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[h]);const R=async(t,s)=>{try{const a=t==="nonprofit"?"nonprofits":"funders",{data:n,error:l}=await U.from(a).select("slug").eq("id",parseInt(s)).single();return l?(console.error(`❌ Error fetching ${t} slug:`,l),null):(console.log(`✅ Found ${t} slug:`,n==null?void 0:n.slug),n==null?void 0:n.slug)}catch(a){return console.error(`💥 Exception fetching ${t} slug:`,a),null}},A=t=>{if(!t)return"";const s=document.createElement("div");return s.innerHTML=t,s.querySelectorAll("span").forEach(n=>{const l=n.dataset.type,i=n.dataset.id,c=n.classList.contains("mention");(l||i)&&!c&&n.classList.add("mention")}),s.innerHTML},H=async t=>{const s=t.target;if(s.tagName==="SPAN"&&(s.classList.contains("mention")||s.dataset.type)){t.preventDefault(),t.stopPropagation();const a=s.dataset.id,n=s.dataset.type;if(!a||!n){console.warn("Missing mention data for click navigation");return}m();try{if(n==="user")console.log(`👤 Navigating to user profile: /profile/members/${a}`),u(`/profile/members/${a}`);else if(n==="organization"){const[l,i]=a.split("-");if(!i){console.warn("⚠️ Invalid organization ID format:",a);return}console.log("🏢 Organization navigation:",{mentionId:a,orgType:l,orgId:i});const c=await R(l,i);if(c)l==="nonprofit"?(console.log(`🏛️ Navigating to nonprofit: /nonprofits/${c}`),u(`/nonprofits/${c}`)):l==="funder"&&(console.log(`💰 Navigating to funder: /funders/${c}`),u(`/funders/${c}`));else{console.error(`❌ Could not find slug for ${l} with ID ${i}`);const z=l==="nonprofit"?`/nonprofits/${i}`:`/funders/${i}`;console.log(`🔄 Trying fallback navigation: ${z}`),u(z)}}}catch(l){console.error("💥 Error during mention navigation:",l)}}};if(!h)return null;const P=()=>r.length>1&&j(t=>(t+1)%r.length),q=()=>r.length>1&&j(t=>(t-1+r.length)%r.length),F=t=>t.target===t.currentTarget&&m(),_=async t=>{await S(t),N(!1)},d=v.find(t=>t.type===C);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-6",onClick:F,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex",onClick:t=>t.stopPropagation(),children:[E&&e.jsxs("div",{className:"flex-[2] bg-gradient-to-br from-rose-50 via-orange-50 to-yellow-50 relative flex items-center justify-center",children:[e.jsx("img",{src:r[b],alt:`Post content ${b+1}`,className:"max-w-full max-h-full object-contain"}),e.jsx("button",{onClick:m,className:"absolute top-4 right-4 bg-white/80 hover:bg-white text-black rounded-full p-2 z-10 shadow-lg",children:e.jsx(V,{size:20})}),r.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:q,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-black rounded-full p-2 z-10 shadow-lg",children:e.jsx(X,{size:20})}),e.jsx("button",{onClick:P,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-black rounded-full p-2 z-10 shadow-lg",children:e.jsx(G,{size:20})}),e.jsxs("div",{className:"absolute top-4 left-4 bg-black bg-opacity-70 text-white px-3 py-1 rounded-full text-sm font-medium",children:[b+1," / ",r.length]})]})]}),e.jsxs("div",{className:"bg-white flex flex-col flex-1 min-w-[420px] max-w-[480px]",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx(J,{author:o.profiles,createdAt:o.created_at,isAuthor:(x==null?void 0:x.id)===((k=o.profiles)==null?void 0:k.id)})}),o.content&&e.jsx("div",{className:"px-6 py-4 border-b",children:e.jsx("div",{className:"text-gray-800 leading-relaxed text-base",onClick:H,dangerouslySetInnerHTML:{__html:A(o.content)}})}),(($=o.tags)==null?void 0:$.length)>0&&e.jsx("div",{className:"px-6 py-3 border-b",children:e.jsx(K,{tags:o.tags})}),e.jsx("div",{className:"px-6 py-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[y>0&&e.jsx("div",{className:"flex items-center -space-x-1 mr-2",children:(I||[]).sort((t,s)=>s.count-t.count).slice(0,3).map(({type:t})=>{const s=v.find(a=>a.type===t);return s?e.jsx("div",{className:`p-0.5 rounded-full ${s.color} border-2 border-white`,children:e.jsx(s.Icon,{size:12,className:"text-white"})},t):null})}),e.jsx(O,{likeCount:y,reactors:L,onViewReactions:M})]}),p>0&&e.jsxs("span",{className:"text-gray-600 text-sm hover:underline cursor-pointer",children:[p," ",p===1?"comment":"comments"]})]})}),e.jsxs("div",{className:"px-6 py-3 border-b flex items-center space-x-1",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{onClick:()=>N(!w),className:`w-full flex items-center justify-center space-x-2 py-3 px-4 rounded-lg hover:bg-gray-100 ${d?d.color.replace("bg-","text-"):"text-gray-600"}`,children:[d?e.jsx(d.Icon,{size:20}):e.jsx(Q,{size:20}),e.jsx("span",{className:"font-medium text-sm",children:d?d.label:"Like"})]}),w&&e.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-white rounded-lg shadow-lg border p-2 flex space-x-1",children:v.map(({type:t,Icon:s,color:a,label:n})=>e.jsx("button",{onClick:()=>_(t),className:`p-2 rounded-full hover:scale-110 ${a}`,title:n,children:e.jsx(s,{size:16,className:"text-white"})},t))})]}),e.jsxs("button",{className:"flex-1 flex items-center justify-center space-x-2 text-gray-600 hover:bg-gray-100 py-3 px-4 rounded-lg",children:[e.jsx(W,{size:20}),e.jsx("span",{className:"font-medium text-sm",children:"Comment"})]}),e.jsxs("button",{className:"flex-1 flex items-center justify-center space-x-2 text-gray-600 hover:bg-gray-100 py-3 px-4 rounded-lg",children:[e.jsx(Y,{size:20}),e.jsx("span",{className:"font-medium text-sm",children:"Share"})]})]}),e.jsx("div",{className:"p-6 flex-1 overflow-y-auto",children:e.jsx(Z,{post:o,currentUserProfile:x,onCommentAdded:T,onCommentDeleted:D,compact:!0})})]})]})})}export{te as default};
